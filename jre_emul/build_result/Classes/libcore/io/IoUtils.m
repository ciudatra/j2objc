//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: android/libcore/luni/src/main/java/libcore/io/IoUtils.java
//
//  Created by retechretech on 13-4-26.
//

#import "IOSByteArray.h"
#import "IOSObjectArray.h"
#import "java/io/ByteArrayOutputStream.h"
#import "java/io/File.h"
#import "java/io/FileDescriptor.h"
#import "java/io/FileInputStream.h"
#import "java/io/IOException.h"
#import "java/io/InterruptedIOException.h"
#import "java/lang/AutoCloseable.h"
#import "java/lang/Exception.h"
#import "java/lang/IllegalArgumentException.h"
#import "java/lang/RuntimeException.h"
#import "java/lang/Thread.h"
#import "libcore/io/ErrnoException.h"
#import "libcore/io/IoUtils.h"
#import "libcore/io/Libcore.h"
#import "libcore/io/Os.h"
#import "libcore/io/OsConstants.h"

@implementation LibcoreIoIoUtils

+ (NSArray *)memDebugStaticReferences {
  NSMutableArray *result = [NSMutableArray array];
  return result;
}

- (id)init {
  return JreMemDebugAdd([super init]);
}

+ (void)closeWithJavaIoFileDescriptor:(JavaIoFileDescriptor *)fd {
  @try {
    if (fd != nil && [((JavaIoFileDescriptor *) NIL_CHK(fd)) valid]) {
      [((id<LibcoreIoOs>) NIL_CHK([LibcoreIoLibcore os])) closeWithJavaIoFileDescriptor:fd];
    }
  }
  @catch (LibcoreIoErrnoException *errnoException) {
    @throw [((LibcoreIoErrnoException *) NIL_CHK(errnoException)) rethrowAsIOException];
  }
}

+ (void)closeQuietlyWithJavaLangAutoCloseable:(id<JavaLangAutoCloseable>)closeable {
  if (closeable != nil) {
    @try {
      [closeable close];
    }
    @catch (JavaLangRuntimeException *rethrown) {
      @throw rethrown;
    }
    @catch (JavaLangException *ignored) {
    }
  }
}

+ (void)closeQuietlyWithJavaIoFileDescriptor:(JavaIoFileDescriptor *)fd {
  @try {
    [LibcoreIoIoUtils closeWithJavaIoFileDescriptor:fd];
  }
  @catch (JavaIoIOException *ignored) {
  }
}

+ (void)setBlockingWithJavaIoFileDescriptor:(JavaIoFileDescriptor *)fd
                                   withBOOL:(BOOL)blocking {
  @try {
    int flags = [((id<LibcoreIoOs>) NIL_CHK([LibcoreIoLibcore os])) fcntlVoidWithJavaIoFileDescriptor:fd withInt:LibcoreIoOsConstants_F_GETFL];
    if (!blocking) {
      flags |= LibcoreIoOsConstants_O_NONBLOCK;
    }
    else {
      flags &= ~LibcoreIoOsConstants_O_NONBLOCK;
    }
    [((id<LibcoreIoOs>) NIL_CHK([LibcoreIoLibcore os])) fcntlLongWithJavaIoFileDescriptor:fd withInt:LibcoreIoOsConstants_F_SETFL withLongInt:flags];
  }
  @catch (LibcoreIoErrnoException *errnoException) {
    @throw [((LibcoreIoErrnoException *) NIL_CHK(errnoException)) rethrowAsIOException];
  }
}

+ (IOSByteArray *)readFileAsByteArrayWithNSString:(NSString *)path {
  return [[LibcoreIoIoUtils readFileAsBytesWithNSString:path] toByteArray];
}

+ (NSString *)readFileAsStringWithNSString:(NSString *)path {
  return [[LibcoreIoIoUtils readFileAsBytesWithNSString:path] description];
}

+ (JavaIoByteArrayOutputStream *)readFileAsBytesWithNSString:(NSString *)path {
  JavaIoFileInputStream *f = nil;
  @try {
    f = [[[JavaIoFileInputStream alloc] initWithNSString:path] autorelease];
    JavaIoByteArrayOutputStream *bytes = [[[JavaIoByteArrayOutputStream alloc] init] autorelease];
    IOSByteArray *buffer = [[[IOSByteArray alloc] initWithLength:8192] autorelease];
    while (YES) {
      int byteCount = [((JavaIoFileInputStream *) NIL_CHK(f)) readWithJavaLangByteArray:buffer];
      if (byteCount == -1) {
        return bytes;
      }
      [((JavaIoByteArrayOutputStream *) NIL_CHK(bytes)) writeWithJavaLangByteArray:buffer withInt:0 withInt:byteCount];
    }
  }
  @finally {
    [LibcoreIoIoUtils closeQuietlyWithJavaLangAutoCloseable:f];
  }
}

+ (void)deleteContentsWithJavaIoFile:(JavaIoFile *)dir {
  IOSObjectArray *files = [((JavaIoFile *) NIL_CHK(dir)) listFiles];
  if (files == nil) {
    @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"not a directory: %@", dir]] autorelease];
  }
  {
    IOSObjectArray *a__ = files;
    int n__ = (int) [((IOSObjectArray *) NIL_CHK(a__)) count];
    for (int i__ = 0; i__ < n__; i__++) {
      JavaIoFile *file = ((JavaIoFile *) [((IOSObjectArray *) NIL_CHK(a__)) objectAtIndex:i__]);
      if ([((JavaIoFile *) NIL_CHK(file)) isDirectory]) {
        [LibcoreIoIoUtils deleteContentsWithJavaIoFile:file];
      }
      if (![((JavaIoFile *) NIL_CHK(file)) delete__]) {
        @throw [[[JavaIoIOException alloc] initWithNSString:[NSString stringWithFormat:@"failed to delete file: %@", file]] autorelease];
      }
    }
  }
}

+ (BOOL)canOpenReadOnlyWithNSString:(NSString *)path {
  @try {
    JavaIoFileDescriptor *fd = [((id<LibcoreIoOs>) NIL_CHK([LibcoreIoLibcore os])) openWithNSString:path withInt:LibcoreIoOsConstants_O_RDONLY withInt:0];
    [((id<LibcoreIoOs>) NIL_CHK([LibcoreIoLibcore os])) closeWithJavaIoFileDescriptor:fd];
    return YES;
  }
  @catch (LibcoreIoErrnoException *errnoException) {
    return NO;
  }
}

+ (void)throwInterruptedIoException {
  [[JavaLangThread currentThread] interrupt];
  @throw [[[JavaIoInterruptedIOException alloc] init] autorelease];
}

- (void)dealloc {
  JreMemDebugRemove(self);
  [super dealloc];
}

@end
